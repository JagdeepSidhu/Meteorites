<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="description" content="Keep track of meteorites in your area!">	<title>Welcome to Stardate!</title>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<script type="text/javascript">
			// Your Client ID can be retrieved from your project in the Google
			// Developer Console, https://console.developers.google.com
			var CLIENT_ID = '297722772661-5kuetqvj5s4fn14d9ftlcu630nea5jid.apps.googleusercontent.com';

			var SCOPES = ['https://www.googleapis.com/auth/gmail.readonly'];

			/**
			 * Check if current user has authorized this application.
			 */
			 function checkAuth() {
			 	gapi.auth.authorize(
			 	{
			 		'client_id': CLIENT_ID,
			 		'scope': SCOPES.join(' '),
			 		'immediate': true
			 	}, handleAuthResult);
			 }

			/**
			 * Handle response from authorization server.
			 *
			 * @param {Object} authResult Authorization result.
			 */
			 function handleAuthResult(authResult) {
			 	var authorizeDiv = document.getElementById('authorize-div');
			 	if (authResult && !authResult.error) {
					// Hide auth UI, then load client library.
					authorizeDiv.style.display = 'none';
					loadGmailApi();
				} else {
					// Show auth UI, allowing the user to initiate authorization by
					// clicking authorize button.
					authorizeDiv.style.display = 'inline';
				}
			}

			/**
			 * Initiate auth flow in response to user clicking authorize button.
			 *
			 * @param {Event} event Button click event.
			 */
			 function handleAuthClick(event) {
			 	gapi.auth.authorize(
			 		{client_id: CLIENT_ID, scope: SCOPES, immediate: false},
			 		handleAuthResult);
			 	return false;
			 }

			/**
			 * Load Gmail API client library. List labels once client library
			 * is loaded.
			 */
			 function loadGmailApi() {
			 	gapi.client.load('gmail', 'v1', listLabels);
			 }

			/**
			 * Print all Labels in the authorized user's inbox. If no labels
			 * are found an appropriate message is printed.
			 */
			 function listLabels() {
			 	var request = gapi.client.gmail.users.labels.list({
			 		'userId': 'me'
			 	});

			 	request.execute(function(resp) {
			 		var labels = resp.labels;
			 		appendPre('Labels:');

			 		if (labels && labels.length > 0) {
			 			for (i = 0; i < labels.length; i++) {
			 				var label = labels[i];
			 				appendPre(label.name)
			 			}
			 		} else {
			 			appendPre('No Labels found.');
			 		}
			 	});
			 }

			/**
			 * Append a pre element to the body containing the given message
			 * as its text node.
			 *
			 * @param {string} message Text to be placed in pre element.
			 */
			 function appendPre(message) {
			 	var pre = document.getElementById('output');
			 	var textContent = document.createTextNode(message + '\n');
			 	pre.appendChild(textContent);
			 }

			</script>
			<script src="https://apis.google.com/js/client.js?onload=checkAuth">
			</script>	

		</head>
		<body>
			<div class='container'>
				<div class="col-sm-3">
					<h1>Login</h1>
					<script>
			// This is called with the results from from FB.getLoginStatus().
			function statusChangeCallback(response) {
				console.log('statusChangeCallback');
				console.log(response);
				// The response object is returned with a status field that lets the
				// app know the current login status of the person.
				// Full docs on the response object can be found in the documentation
				// for FB.getLoginStatus().
				if (response.status === 'connected') {
					// Logged into your app and Facebook.
					testAPI();
				} else if (response.status === 'not_authorized') {
					// The person is logged into Facebook, but not your app.
					document.getElementById('status').innerHTML = 'Please log ' +
					'into this app.';
				} else {
					// The person is not logged into Facebook, so we're not sure if
					// they are logged into this app or not.
					document.getElementById('status').innerHTML = 'Please log ' +
					'into Facebook.';
				}
			}

			// This function is called when someone finishes with the Login
			// Button.  See the onlogin handler attached to it in the sample
			// code below.
			function checkLoginState() {
				FB.getLoginStatus(function(response) {
					statusChangeCallback(response);
				});
			}

			window.fbAsyncInit = function() {
				FB.init({
					appId      : '336736560049290',
				cookie     : true,  // enable cookies to allow the server to access 
														// the session
				xfbml      : true,  // parse social plugins on this page
				version    : 'v2.5' // use graph api version 2.5
			});

			// Now that we've initialized the JavaScript SDK, we call 
			// FB.getLoginStatus().  This function gets the state of the
			// person visiting this page and can return one of three states to
			// the callback you provide.  They can be:
			//
			// 1. Logged into your app ('connected')
			// 2. Logged into Facebook, but not your app ('not_authorized')
			// 3. Not logged into Facebook and can't tell if they are logged into
			//    your app or not.
			//
			// These three cases are handled in the callback function.

			FB.getLoginStatus(function(response) {
				statusChangeCallback(response);
			});

		};

			// Load the SDK asynchronously
			(function(d, s, id) {
				var js, fjs = d.getElementsByTagName(s)[0];
				if (d.getElementById(id)) return;
				js = d.createElement(s); js.id = id;
				js.src = "//connect.facebook.net/en_US/sdk.js";
				fjs.parentNode.insertBefore(js, fjs);
			}(document, 'script', 'facebook-jssdk'));

			// Here we run a very simple test of the Graph API after login is
			// successful.  See statusChangeCallback() for when this call is made.
			function testAPI() {
				console.log('Welcome!  Fetching your information.... ');
				FB.api('/me', function(response) {
					console.log('Successful login for: ' + response.name);
					document.getElementById('status').innerHTML =
					'Thanks for logging in, ' + response.name + '!';
				});
			}
		</script>

<!--
	Below we include the Login Button social plugin. This button uses
	the JavaScript SDK to present a graphical Login button that triggers
	the FB.login() function when clicked.
-->

<fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
</fb:login-button>

<div id="status">
</div>
<hr>

<div id="authorize-div" style="display: none">
	<span>Authorize access to Gmail API</span>
	<!--Button for the user to click to initiate auth sequence -->
	<button id="authorize-button" onclick="handleAuthClick(event)">
		Authorize
	</button>
</div>
<pre id="output"></pre>

</div>

<div class="col-sm-9">
	<h2 style="border:solid 2px black;width:100%;height:700px">Welcome to Stardate</h2>
</div>

<!-- Welcome page -->
<!-- Something flashy to get users to register -->
</div>
</body>
</html>